# .Net HTTP Delegating Handlers in C# & Automatic Decompression

```csharp
// <summary>
/// Handler to add mandatory headers to avoid Akamai deny.
/// </summary>
public class AntiBotHttpHandler : DelegatingHandler
{
    private const string ConnectionHeaderValue = "keep-alive";
    private const string UserAgentValue = "espaceclientadmin";
    private const string AcceptLanguageValue = "*";
    private static readonly string[] AcceptEncodingValues = { "gzip", "deflate", "br" };

    protected override Task<HttpResponseMessage> SendAsync(
        HttpRequestMessage request,
        CancellationToken cancellationToken)
    {
        request.Headers.UserAgent.Add(new ProductInfoHeaderValue(UserAgentValue, null));
        request.Headers.Connection.Add(ConnectionHeaderValue);

        foreach (var encoding in AcceptEncodingValues)
        {
            request.Headers.AcceptEncoding.Add(new StringWithQualityHeaderValue(encoding));
        }
        
        if (request.RequestUri != null)
        {
            request.Headers.Host = request.RequestUri.Host;
        }
        
        request.Headers.AcceptLanguage.Add(new StringWithQualityHeaderValue(AcceptLanguageValue));
        return base.SendAsync(request, cancellationToken);
    }
}
```
