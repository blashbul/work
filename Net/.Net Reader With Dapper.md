# .Net Reader With Dapper ( A refacto pour Ã©viter le new)

```csharp
using Dapper;
using Npgsql;

  //  Ou passer par un IOptions ou une action de configuration
  public class PointsReader(string connectionString)
  {
      public async Task<IEnumerable<Point>> Get(GetPointQuery request, CancellationToken cancellationToken)
      {
          var query = $@"querry";

          await using var connection = new NpgsqlConnection(connectionString);

          var cmd = new CommandDefinition(query,
              parameters: new
              {
                  clientids = request.ClientIds,
                  searchExpression = searchedExpression
              },
              cancellationToken: cancellationToken);

          var points = (await connection.QueryAsync<Point>(cmd)).ToList();

          return points;
      }
  }

  ...
```

Dans le startup

```csharp
builder.Services.AddScoped<PointsReader>(_ =>
    new PointsReader(builder.Configuration.GetConnectionString("STERNE_API")));
```
